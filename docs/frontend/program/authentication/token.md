
# Token

## 过程
1. 客户端使用用户名跟密码请求登录;
2. 服务端验证通过后，生成一个 `Token` ，发送给客户端；
3. 客户端收到 `Token` 后，存储在 `Cookie` 或 `LocalStorage` 或 `SessionStorage` 里。
4. 客户端之后的每一次请求，通过 `request header` 的 `Authorization` 
5. 服务端通过这个 `Token`，从而知道用户的身份。

## 优点
不需要在服务端去保留用户的认证信息，解决 `Session` 拓展性的的弊端。

## 缺点
1. 占带宽：`Token` 通常比 `SESSIONID` 大，需要消耗更多流量，挤占更多带宽（不过可以忽略不计）；
2. 性能问题： 相比于 `session-cookie`，需要服务端花费更多的时间和性能来对 `Token` 进行解密验证。

## Token 与 Session 的区别
1. 使用 `Token`，服务端不需要保留状态，有更好的拓展性；
2. `Token` 不需要借助 `Cookie`，可以预防 `CSRF`；
3. `SESSIONID` 是在登陆的时候生成的而且在登出时一直不变的，在一定程度上安全就会低，而 `Token`是可以在一段时间内动态改变的。

## JWT
全称 `JSON Web Token`，基于 `Token` 的一种解决方案。

`JWT` 的原理是，服务器认证后，生成一个 `JSON` 对象，经过服务器签名加密后返回给用户，以后用户每次请求都带着这个令牌。

`JWT` 由三部分构成：`Header`（头部）、`Payload`（负载）、`Signature`（签名）。

### JWT 特点
1. 在服务端通过密钥加密生成签名 `Signature`；
2. 不能将秘密数据写进未加密的 `JWT` 中；
3. 降低服务器查询数据库的次数；
4. `JWT` 包含认证信息，一旦泄露，任何人都可以获得该令牌的所有权限；
5. 为了减少盗用，`JWT` 不应该使用 `HTTP` 协议明码传输，要使用 `HTTPS` 协议传输。


## Token 和 JWT 的区别

相同点：
* 都是访问资源的令牌
* 都是记录用户的信息
* 使服务端无状态化，将凭证存放在客户端

区别：
* `Token` 服务器收到凭证后，需要查库获取用户信息，从而验证 `Token` 是否有效；
* `JWT` 将 `Header` 和 `Payload` 通过秘钥加密生成凭证，服务端只需要根据秘钥解密校验即可，不需要查库或少查库，因为 `JWT` 自带用户信息和加密的数据。