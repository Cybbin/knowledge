# HTTPS

## HTTPS 握手

HTTPS 握手在 HTTP 握手的基础上新增 SSL/TLS 握手。  
SSL/TLS 握手是客户端和服务端安全地协商出一种对称加密的秘钥。

---

### SSL/TLS握手的过程

第一步：客户端向服务端发送 Client Hello 消息，消息包含客户端生成的随机数 ::Random 1::、客户端支持的加密套件和 SSL 版本等信息；

第二步：服务端向客户端先发送 Server Hello 消息，消息包括将客户端传过来的加密套件确认一份，另外生成一个随机数 ::Random 2::，然后服务端将自己的证书下发给客户端，发送 Server Hello Done 消息；

第三步：客户端收到证书后，从 CA 验证证书的合法性，验证通过后取出证书中的公钥，再生成一个随机数 ::Random 3::，用证书中的公钥对称加密该随机数 ::Random 3:: 生成 PreMaster Key，服务端用自己的私钥解密 PreMaster Key 生成 ::Random 3::，
然后客户端和服务端结合 ::Random 1 2 3:: 通过伪随机函数生成秘钥，之后都是用这个秘钥进行对称加密；

第四步：客户端通知服务端之后再发的消息会使用之前的生成的秘钥加密；

第五步：客户端向服务端发送 Client Finish 消息，这是客户端第一次用生成的秘钥加密，服务端收到后会用秘钥解密；

第六步：服务端向客户端发送 New Session Ticket 报文，这个 Session Ticket 只有服务器才能解密，客户端保存下来，在以后 TLS握手过程中带伤它可以快速恢复会话，减少往返延迟；

第七步：服务端通知客户端之后再发的消息会使用之前的生成的秘钥加密；

第八步：服务端向客户端发送 Server Finish 消息，这是服务端第一次用生成的秘钥加密，客户端收到后会用秘钥解密。

至此，双方已安全地协商出同一份秘钥，之后所有的消息都会通过这个秘钥加密后再通过TCP进行可靠传输。

---

## 和 HTTP 的区别

说明|HTTP|HTTPS
:--:|:--:|:--:
安全|无| 加密、认证、完整性保护
安全协议|无|TLS/SSL
传输方式|明文传输|通过 TLS/SSL 生成的秘钥进行对称加密后再传输
端口号|80|443
证书|无|需要到 CA 申请证书，需要交费
状态性|基于无状态|由 TLS/SSL 协议构成可进行加密传输、身份认证的网络协议，比 HTTP 协议安全

优、缺点|HTTP|HTTPS
:--:|:--:|:--:
优点||1. SEO方面，相对于 HTTP 排名更靠前（谷歌、百度搜索）；<br>2. 安全性方面：相对 HTTP 更加安全。
缺点|1. 通信使用明文，内容会被窃听 （对应加密）；<br>2. 基于无状态，不验证通信方的身份，会遭遇伪装（对应认证）；<br>3. 无法验证报文的完整性，可能被篡改（对应完整性）。|1. 相对于 HTTP 加载时间更长，增加数据开销和功耗；<br>2. HTTPS 需要付费申请证书；<br>3. 对服务器带来更大成本开销；<br>4. SSL 证书需要绑定 IP，不能在同一个 IP 绑定多个域名。